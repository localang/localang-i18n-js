/*!
 * localang-i18n-js v0.0.4
 * (c) Localang
 * Released under the MIT License.
 */
!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fs"),require("path"),require("https")):"function"==typeof define&&define.amd?define(["exports","fs","path","https"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).localang={},n.fs,n.path,n.https)}(this,(function(n,e,t,r){"use strict";var o=function(){return o=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},o.apply(this,arguments)};function i(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{c(r.next(n))}catch(n){i(n)}}function s(n){try{c(r.throw(n))}catch(n){i(n)}}function c(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,s)}c((r=r.apply(n,e||[])).next())}))}function a(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(n,a)}catch(n){s=[6,n],r=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}"function"==typeof SuppressedError&&SuppressedError;var s=function(n,e){return void 0===e&&(e={}),n.replace(/\{(\w+)}/g,(function(n,t){return t in e?String(e[t]):n}))},c=function(n){var e=n.replace(/const keyset = |;/g,"");e=(e=(e=e.substring(e.indexOf("\n")+1)).substring(0,e.lastIndexOf("\n"))).substring(0,e.lastIndexOf("\n"));var t={};try{t=JSON.parse(e)}catch(n){console.log("JSON parse error: ".concat(n))}return t},u=function(){function n(){this.settings={lang:"en"},this.setSettings=this.setSettings.bind(this),this.makeI18n=this.makeI18n.bind(this)}return n.prototype.setSettings=function(n){this.settings=o(o({},this.settings),n)},n.prototype.makeI18n=function(n){return function(n,e){return function(t,r){var o=e[t];if(!o)return"";var i=o[n];if("object"==typeof i&&null!==i){if(!r)return i.zero;var a=Object.keys(r).find((function(n){return/^count([0-9+]?)+$/.test(n)})),c=a&&a in r&&Number(r[a])||0,u=0===c?"zero":new Intl.PluralRules(n).select(c);return s(i[u],r)}return i?s(i,r):""}}(this.settings.lang,n)},n}(),l={module:{importT:"import { makeI18n } from 'localang-i18n-js';",exportT:"export const i18n = makeI18n(keyset);",getImportFromI18nFileT:function(n){return"import { i18n } from './".concat(n,"';\n")}},commonjs:{importT:"const { makeI18n } = require('localang-i18n-js');",exportT:"module.exports = makeI18n(keyset);",getImportFromI18nFileT:function(n){return"const i18n = require('./".concat(n,"');\n")}}};var f,p=function(n){var r=n.keyLanguage,i=n.langs,a=n.fileExt,s=n.importType;return{create:function(n){var u=new Set,f=l[s],p=f.importT,d=f.exportT,y=f.getImportFromI18nFileT;return{CallExpression:function(e){var t,r;"name"in e.callee&&"i18n"===(null===(t=e.callee)||void 0===t?void 0:t.name)&&e.arguments.length>=1&&"Literal"===(null===(r=e.arguments[0])||void 0===r?void 0:r.type)&&"string"==typeof e.arguments[0].value&&!n.filename.includes(".i18n.")&&u.add(e.arguments[0].value)},"Program:exit":function(){var s=n.filename.substring(0,n.filename.lastIndexOf(".")),l=t.basename(n.filename),f=l.substring(0,l.lastIndexOf(".")),g="".concat(f,".i18n"),h="".concat(s,".i18n.").concat(a),m=function(n){if(e.existsSync(n)){var t=e.readFileSync(n,"utf8");return c(t)}return{}}(h),v=o({},m);u.forEach((function(n){if(!v[n]){var e=/\bcount\d*\b/.test(n);v[n]={},i.forEach((function(t){var o=t===r?n:"";v[n][t]=e?{zero:o,one:o,two:o,few:o,many:o,other:o}:o}))}})),Object.keys(m).forEach((function(n){u.has(n)||delete v[n]})),0===Object.keys(v).length?function(n){e.existsSync(n)&&e.unlinkSync(n)}(h):(function(n){var t=n.fileName,r=n.keyset,o=n.exportT,i=n.importT;e.writeFileSync(t,"".concat(i,"\n\nconst keyset = ").concat(JSON.stringify(r,null,4),";\n\n").concat(o,"\n"))}({fileName:h,keyset:v,importT:p,exportT:d}),function(n,t,r){var o=e.readFileSync(n,"utf8");o.includes(t)||e.writeFileSync(n,r+o)}(n.filename,g,y(g)))}}}}},d=(f=new u).makeI18n,y=f.setSettings;n.createEslintPlugin=function(n){var e=void 0===n?{}:n,t=e.keyLanguage,r=void 0===t?"en":t,o=e.langs,i=void 0===o?["en"]:o,a=e.fileExt,s=void 0===a?"js":a,c=e.importType;return{rules:{"generate-i18n-file":p({keyLanguage:r,langs:i,fileExt:s,importType:void 0===c?"module":c})}}},n.makeI18n=d,n.pull=function(n,t){var o=r.request({hostname:"localang.xyz",port:443,path:"/api/translations/getAll?project_id=".concat(t),method:"GET",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}},(function(n){var t="";n.on("data",(function(n){t+=n})),n.on("end",(function(){var n=JSON.parse(t);if("success"!==(null==n?void 0:n.status))throw new Error("Error getting keysets");n.files.forEach((function(n){var t=n.filePath,r=n.keyset,o=t.split(".");o[o.length-1]="i18n.".concat(o.at(-1));var i=o.join(".");e.existsSync(i)?e.readFile(i,"utf8",(function(n,t){if(n)throw new Error("Error reading file ".concat(i,": ").concat(n.message));var o=JSON.stringify(r,null,4),a=t.replace(/const keyset = {[\s\S]*?};/,"const keyset = ".concat(o,";"));e.writeFileSync(i,a)})):console.log("File ".concat(i," doesn't exist"))}))}))}));o.on("error",(function(n){throw new Error("Error syncing keysets: ".concat(n.message))})),o.end()},n.push=function(n,o,s){var u={};s.forEach((function(n){return i(void 0,void 0,void 0,(function(){var r,o,i,s;return a(this,(function(a){return r=t.resolve(process.cwd(),n),o=n.replace(/\.i18n\./,"."),e.existsSync(r)?(i=e.readFileSync(r,"utf8"),s=c(i),u[o]={operation:"update",translations:s}):u[o]={operation:"delete"},[2]}))}))}));var l=r.request({hostname:"localang.xyz",port:443,path:"/api/translations/update",method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"}},(function(n){var e="";n.on("data",(function(n){e+=n})),n.on("end",(function(){var n=JSON.parse(e);if("success"!==(null==n?void 0:n.status))throw new Error("Error syncing keysets")}))}));l.write(JSON.stringify({project_id:o,files:u})),l.on("error",(function(n){throw new Error("Error syncing keysets: ".concat(n.message))})),l.end()},n.setSettings=y}));
//# sourceMappingURL=index.umd.min.js.map
