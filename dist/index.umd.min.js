/*!
 * localang-js-lib v0.0.1
 * (c) Localang
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("fs"),require("path"),require("https")):"function"==typeof define&&define.amd?define(["exports","fs","path","https"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).localang={},e.fs,e.path,e.https)}(this,(function(e,n,t,r){"use strict";var o=function(){return o=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},o.apply(this,arguments)};function i(e,n,t,r){return new(t||(t=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}c((r=r.apply(e,n||[])).next())}))}function s(e,n){var t,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=n.call(e,s)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var a=function(e,n){return void 0===n&&(n={}),e.replace(/\{(\w+)}/g,(function(e,t){return t in n?String(n[t]):e}))},c=function(e){return i(void 0,void 0,void 0,(function(){var n,t,r,o;return s(this,(function(i){switch(i.label){case 0:n={},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,import(e)];case 2:return t=i.sent(),n=null!==(o=t.keyset)&&void 0!==o?o:{},[3,4];case 3:return r=i.sent(),console.log("Reading error: ".concat(r)),[3,4];case 4:return[2,n]}}))}))},u=function(){function e(){this.settings={lang:"en"},this.setSettings=this.setSettings.bind(this),this.makeI18n=this.makeI18n.bind(this)}return e.prototype.setSettings=function(e){this.settings=o(o({},this.settings),e)},e.prototype.makeI18n=function(e,n){return function(e,n,t){return function(r){var o=n[r];if(!o)return"";var i=o[e];if("object"==typeof i&&null!==i){if(!t)return i.zero;var s=Object.keys(t).find((function(e){return/^count([0-9+]?)+$/.test(e)})),c=s&&s in t&&Number(t[s])||0,u=0===c?"zero":new Intl.PluralRules(e).select(c);return a(i[u],t)}return i?a(i,t):""}}(this.settings.lang,e,n)},e}(),l={module:{importT:"import { makeI18n } from 'localang-i18n-js';",exportT:"export const i18n = makeI18n(keyset);",getImportFromI18nFileT:function(e){return"import { i18n } from './".concat(e,"';\n")}},commonjs:{importT:"const { makeI18n } = require('localang-i18n-js');",exportT:"module.exports = makeI18n(keyset);",getImportFromI18nFileT:function(e){return"const i18n = require('./".concat(e,"');\n")}}};function f(e){return n.existsSync(e)?function(e){var n=e.replace(/const keyset = |;/g,"");n=(n=(n=(n=n.substring(n.indexOf("\n")+1)).substring(0,n.lastIndexOf("\n"))).substring(0,n.lastIndexOf("\n"))).substring(0,n.lastIndexOf("\n"));var t={};try{t=JSON.parse(n)}catch(e){console.log("JSON parse error: ".concat(e))}return t}(n.readFileSync(e,"utf8")):{}}var p,g=function(e){var r=e.keyLanguage,i=e.langs,s=e.fileExt,a=e.importType;return{create:function(e){var c=new Set,u=l[a],p=u.importT,g=u.exportT,d=u.getImportFromI18nFileT;return{CallExpression:function(n){var t,r;"name"in n.callee&&"i18n"===(null===(t=n.callee)||void 0===t?void 0:t.name)&&n.arguments.length>=1&&"Literal"===(null===(r=n.arguments[0])||void 0===r?void 0:r.type)&&"string"==typeof n.arguments[0].value&&!e.filename.includes(".i18n.")&&c.add(n.arguments[0].value)},"Program:exit":function(){var a=e.filename.substring(0,e.filename.lastIndexOf(".")),u="".concat(a,".i18n.").concat(s),l=f(u),y=o({},l);c.forEach((function(e){if(!y[e]){var n=/\bcount\d*\b/.test(e);y[e]={},i.forEach((function(t){var o=t===r?e:"";y[e][t]=n?{zero:o,one:o,two:o,few:o,many:o,other:o}:o}))}})),Object.keys(l).forEach((function(e){c.has(e)||delete y[e]})),0===Object.keys(y).length?function(e){n.existsSync(e)&&n.unlinkSync(e)}(u):(function(e){var t=e.fileName,r=e.keyset,o=e.exportT,i=e.importT;n.writeFileSync(t,"".concat(i,"\n\nconst keyset = ").concat(JSON.stringify(r,null,4),";\n\n").concat(o,"\n"))}({fileName:u,keyset:y,importT:p,exportT:g}),function(e,t){var r=n.readFileSync(e,"utf8");/import\s*\{\s*i18n\s*\}\s*from\s*['"]\..*\.i18n\.js['"]\s*;/.test(r)||/const\s*{\s*i18n\s*}\s*=\s*require\s*\(['"]\..*\.i18n\.js['"]\)\s*;/.test(r)||n.writeFileSync(e,t+r)}(e.filename,d(t.basename(u))))}}}}},d=(p=new u).makeI18n,y=p.setSettings;e.createEslintPlugin=function(e){var n=void 0===e?{}:e,t=n.keyLanguage,r=void 0===t?"en":t,o=n.langs,i=void 0===o?["en"]:o,s=n.fileExt,a=void 0===s?"js":s,c=n.importType;return{configs:{generateI18nFile:[{ignores:["**/*.i18n.*"]}]},rules:{"generate-i18n-file":g({keyLanguage:r,langs:i,fileExt:a,importType:void 0===c?"module":c})}}},e.makeI18n=d,e.pull=function(e,t){var o=r.request({hostname:"https://localang.xyz",port:443,path:"/api/translations/getAll?project_id=".concat(t),method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}},(function(e){var t="";e.on("data",(function(e){t+=e})),e.on("end",(function(){var e=JSON.parse(t);if("success"!==(null==e?void 0:e.status))throw new Error("Error getting keysets");e.files.forEach((function(e){var t=e.filePath,r=e.keyset;n.existsSync(t)?n.readFile(t,"utf8",(function(e,o){if(e)throw new Error("Error reading file ".concat(t,": ").concat(e.message));var i=JSON.stringify(r,null,4).replace(/"(\w+)":/g,"$1:"),s=o.replace(/const keyset = {[\s\S]*?};/,"const keyset = ".concat(i,";"));n.writeFileSync(t,s)})):console.log("File ".concat(t," doesn't exist"))}))}))}));o.on("error",(function(e){throw new Error("Error syncing keysets: ".concat(e.message))})),o.end()},e.push=function(e,o,a){var u={};a.forEach((function(e){return i(void 0,void 0,void 0,(function(){var r,o,i,a;return s(this,(function(s){switch(s.label){case 0:if(r=t.resolve(process.cwd(),e),o=r.replace(/\.i18n\./,"."),!n.existsSync(r))return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,c(r)];case 2:return i=s.sent(),u[o]={operation:"update",translations:i},[3,4];case 3:throw a=s.sent(),new Error("Error parsing JSON in file ".concat(e,": ").concat("object"==typeof a&&null!==a&&"message"in a?a.message:""));case 4:return[3,6];case 5:u[o]={operation:"delete"},s.label=6;case 6:return[2]}}))}))}));var l=r.request({hostname:"https://localang.xyz",port:443,path:"/api/translations/update",method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}},(function(e){var n="";e.on("data",(function(e){n+=e})),e.on("end",(function(){var e=JSON.parse(n);if("success"!==(null==e?void 0:e.status))throw new Error("Error syncing keysets")}))}));l.write({project_id:o,files:u}),l.on("error",(function(e){throw new Error("Error syncing keysets: ".concat(e.message))})),l.end()},e.setSettings=y}));
//# sourceMappingURL=index.umd.min.js.map
